{% extends "layout.html" %}

{% block content %}
<div style="padding: 2rem; font-size: 1.2rem;">
    <label for="annotated-text" style="font-weight:bold;">Annotierter Text:</label>
    <div id="annotated-text" style="width:100%; font-size:1rem; padding:0.5rem; background:#f8f9fa; border:1px solid #ccc; border-radius:4px; min-height:6em;">
        {{ message.annotated_text | safe }}
    </div>

    <div style="margin-top:1.5rem;">
        <div id="annotation-header" style="font-weight:bold; font-size:1.1rem; cursor:pointer; background:#e9ecef; padding:0.5em 0.8em; border-radius:4px; user-select:none;">
            Annotationen ▶
        </div>
        <div id="annotation-list" style="margin-top:0.5rem; display:none;">
        {% if message.annotations and message.annotations|length > 0 %}
            <ul style="padding-left:1.2em;">
            {% for ann in message.annotations %}
                <li style="margin-bottom:0.7em; background:#f1f1f1; border-radius:4px; padding:0.5em; display:flex; align-items:center; gap:0.7em;">
                    <div style="flex:1;">
                        <strong>Position:</strong> {{ ann.start_pos }} - {{ ann.end_pos }}<br>
                        <strong>Annotation:</strong> {{ ann.annotation }}<br>
                        {% if ann.reason %}<strong>Grund:</strong> {{ ann.reason }}<br>{% endif %}
                        <strong>Kommentar:</strong>
                        <input type="text" name="comment_{{ loop.index0 }}" value="{{ ann.comment }}" style="padding:0.2em; border:1px solid #ccc; border-radius:3px; font-size:1em; width:auto; min-width:2em;" oninput="this.style.width = ((this.value.length + 1) * 0.7) + 'em';" />
                    </div>
                    <button type="button" class="save-annotation-btn" style="padding:0.2em 0.7em; background:#28a745; color:white; border:none; border-radius:3px; font-size:1em; cursor:pointer;">Speichern</button>
                    <button type="button" class="delete-annotation-btn" style="padding:0.2em 0.7em; background:#dc3545; color:white; border:none; border-radius:3px; font-size:1em; cursor:pointer;">Löschen</button>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p style="color:#888;">Keine Annotationen vorhanden.</p>
        {% endif %}
        </div>

        <div id="error-header" style="font-weight:bold; font-size:1.1rem; cursor:pointer; background:#ffecec; padding:0.5em 0.8em; border-radius:4px; user-select:none; margin-top:1.2em;">
            Fehlerliste ▶
        </div>
        <div id="error-list" style="margin-top:0.5rem; display:none;">
        {% if message.error_list and message.error_list|length > 0 %}
            <ul style="padding-left:1.2em;">
            {% for err in message.error_list %}
                <li style="margin-bottom:0.7em; background:#ffecec; border-radius:4px; padding:0.5em; color:#b30000;">
                    {{ err }}
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p style="color:#888;">Keine Fehler vorhanden.</p>
        {% endif %}
        </div>

        <div id="spacy-header" style="font-weight:bold; font-size:1.1rem; cursor:pointer; background:#e0f7fa; padding:0.5em 0.8em; border-radius:4px; user-select:none; margin-top:1.2em;">
            Spacy Matches ▶
        </div>
        <div id="spacy-list" style="margin-top:0.5rem; display:none;">
        {% if message.spacy_matches and message.spacy_matches|length > 0 %}
            <ul style="padding-left:1.2em;">
            {% for match in message.spacy_matches %}
                <li style="margin-bottom:0.7em; background:#e0f7fa; border-radius:4px; padding:0.5em; color:#00796b;">
                    {{ match }}
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p style="color:#888;">Keine Spacy Matches vorhanden.</p>
        {% endif %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    function setupCollapsible(headerId, listId, label) {
        var header = document.getElementById(headerId);
        var list = document.getElementById(listId);
        var expanded = false;
        if (header && list) {
            header.addEventListener('click', function() {
                expanded = !expanded;
                if (expanded) {
                    list.style.display = '';
                    header.textContent = label + ' ▼';
                } else {
                    list.style.display = 'none';
                    header.textContent = label + ' ▶';
                }
            });
        }
    }
    setupCollapsible('annotation-header', 'annotation-list', 'Annotationen');
    setupCollapsible('error-header', 'error-list', 'Fehlerliste');
    setupCollapsible('spacy-header', 'spacy-list', 'Spacy Matches');
});
</script>
{% endblock %}